<!DOCTYPE HTML>
<html>
	<head>
		<title>Improved 2D simulation</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../assets/css/noscript.css" /></noscript>
		
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-W1WGEC5GQ8"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'G-W1WGEC5GQ8');
		</script>
	</head>
	<body class="is-preload">
		<div id="wrapper">
			<header id="header">
				<div class="inner">
					<a href="../index.html" class="logo">
						Back to the main page
					</a>
				</div>
			</header>
			<div id="main">
				<div class="inner">
						
<h1>Improved 2D simulation</h1>
<br>
<span class="image main"><img src="lammps_tuto02.jpg" alt="" /></span>

<p>
<b>Objective:</b> This tutorial is a follow up to <a href="../tuto01/tuto01a.html">tutorial 1</a>. Here are going to improve the script previously written and perform slightly more advanced operations, but the simulation will still consists in a 2D box with atoms on the fluid interacting through a simple Lennard-Jones potential (see the image above). 

<br><br>

<b>Prerequisite:</b> It is assumed that you followed <a href="../tuto01/tuto01a.html">tutorial 1</a> first. 

<br><br>

<b>Shortcut:</b> If you already have a good grasp on LAMMPS, you can download directly the input scripts that will be written following this tutorial, respectively <a href="input.min.lammps" target="_blank">input.min.lammps</a> and <a href="input.run.lammps" target="_blank">input.run.lammps</a>.
 
</p>

<h2>Step 1 -- Atoms creation and minimisation </h2>
<br>
<p>
Let us build a system that is slightly different from <a href="../tuto01/tuto01a.html">tutorial 1</a>, and create the atoms of type 1 and 2 in two separate regions, respectively (see the figure above). Create a new folder, and inside the folder create an input script and call it input.min.lammps (as you can anticipate, this simulation will be separated in multiple input scripts). Like in <a href="../tuto01/tuto01a.html">tutorial 1</a>, copy the following first lines into the input script:
<pre><code># Initialization

units		lj
dimension 	2
pair_style	lj/cut 2.5
atom_style	atomic
boundary	p p p</code></pre></p><p>
Like in <a href="../tuto01/tuto01a.html">tutorial 1</a>, let us create a box from a predefined region. However this time, let us also create two additional regions and create atoms of type 1 and 2 in each region respectively. 
<pre><code># System definition

region		mybox block -30 30 -30 30 -0.5 0.5
create_box	2 mybox
region		mycylin cylinder z 0 0 15 INF INF side in
region		mycylou cylinder z 0 0 15 INF INF side out 
create_atoms	1 random 1000 341341 mycylou
create_atoms	2 random 150 127569 mycylin</code></pre></p><p>
The 'side in' and 'side out' keywords allow us to define regions that are respectively 'inside the cylinder', and 'everything that is not inside the cylinder'. We can write the remaining of the input script as follow:
<pre><code># Simulation settings

mass		1 1
mass		2 1
pair_coeff	1 1 1.0 1.0
pair_coeff	2 2 0.5 3.0
neigh_modify	every 1 delay 5 check yes
dump 		mydmp all atom 10 dump.min.lammpstrj

# Run

thermo		10
minimize	1.0e-4 1.0e-6 1000 10000
write_data	data.min.lammps</code></pre></p><p>
The only novelty with respect to <a href="../tuto01/tuto01a.html">tutorial 1</a> is the command 'write_data'. This command asks LAMMPS to print the final state of the simulation in a file named 'data.min.lammps'. This file will be used later to restart the simulation from the final state of the energy minimisation step.
<br><br>
Run LAMMPS with the input.min.lammps script. If everything went well, a dump file named dump.min.lammpstrj should appear in the folder, allowing you to visualise the atoms trajectories during minimisation using VMD or Ovito. In addition, a file named data.min.lammps should have been created. If you open this file, you will see that it contains all the information necesary to restart the simulation, such as the number of atoms and the size of the box:
<pre><code>1150 atoms
2 atom types

-3.0000000000000000e+01 3.0000000000000000e+01 xlo xhi
-3.0000000000000000e+01 3.0000000000000000e+01 ylo yhi
-5.0000000000000000e-01 5.0000000000000000e-01 zlo zhi
</code></pre></p><p>
It also contains the positions and velocities of all the atoms:
<pre><code>Atoms # atomic

345 1 -2.8836527978635523e+01 -2.9323791349242530e+01 0.0000000000000000e+00 0 0 0
979 1 -2.9382597284003467e+01 -2.8335352105920894e+01 0.0000000000000000e+00 0 0 0
435 1 -2.5412729704650008e+01 -2.9697644643809667e+01 0.0000000000000000e+00 0 0 0
533 1 -2.5033422381244598e+01 -2.8519424750144708e+01 0.0000000000000000e+00 0 0 0
347 1 -2.4330866813628781e+01 -2.9373591404712414e+01 0.0000000000000000e+00 0 0 0
448 1 -2.3610197298718113e+01 -2.8518785172533800e+01 0.0000000000000000e+00 0 0 0
(...)
</code></pre></p><p>
Each column corresponds respectively to the atom identity (from 1 to 1150), the atom type (1 or 2 here), the atom positions (x,y,z) and the atom velocities (vx,vy,vz).

<h2>Step 2 -- Restarting from a saved configuration </h2>
<br>
<p>
We are going to create a new input file and start a molecular dynamics simulation directly from the previously saved configuration. In the same folder, create a new file, call it input.run.lammps, and copy the same lines as previously:
<pre><code># Initialization

units		lj
dimension 	2
pair_style	lj/cut 2.5
atom_style	atomic
boundary	p p p</code></pre></p><p>
Now instead of creating a new region, we simply add the following command:
<pre><code># System definition

read_data	data.min.lammps
</code></pre></p><p>
By visualising the previously generated dump.min.lammpstrj file, you may have noticed that some atoms have moved from one region to the other during minimisation: </p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/gfJ_n33-F6A" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


<p>In order to start the simulation from a clean state, with only atoms of type 2 within the cylinder and atoms of type 1 outside the cylinder, let us delete the misplaced atoms:
<pre><code>region		mycylin cylinder z 0 0 15 INF INF side in
region		mycylou cylinder z 0 0 15 INF INF side out
group		mytype1 type 1
group		mytype2 type 2
group		incyl region mycylin
group		oucyl region mycylou
group		type1in intersect mytype1 incyl 
group		type2ou intersect mytype2 oucyl
delete_atoms	group type1in
delete_atoms	group type2ou
</code></pre></p><p>
These commands will respectively recreate the previously defined regions (regions are not saved by the write_data command), create groups, and finally delete the atoms of type 1 that are located within the cylinder, as well as the atoms of type 2 that are located outside the cylinder. If you run LAMMPS, you can see in the terminal how many atoms are in each group, and how many atoms have been deleted:
<pre><code>1000 atoms in group mytype1
150 atoms in group mytype2
120 atoms in group incyl
1030 atoms in group oucyl
1 atoms in group type1in
31 atoms in group type2ou
Deleted 1 atoms, new total = 1149
Deleted 31 atoms, new total = 1118
</code></pre></p><p>
Similarly to previously, add the following simulation settings:
<pre><code># Simulation settings

mass		1 1
mass		2 1
pair_coeff	1 1 1.0 1.0
pair_coeff	2 2 0.5 3.0
neigh_modify	every 1 delay 5 check yes
dump 		mydmp all atom 500 dump.run.lammpstrj
</code></pre></p><p>
In addition, it would be great to extract data directly from the simulation. For example, let us extract the number of atoms of each type in each region, by adding the following commands:
<pre><code>variable	Ntype1in equal count(mytype1,mycylin)
variable	Ntype1ou equal count(mytype1,mycylou)
variable	Ntype2in equal count(mytype2,mycylin)
variable	Ntype2ou equal count(mytype2,mycylou)
fix		myat1 all ave/time 1000 1 1000 v_Ntype1in v_Ntype1ou file population1vstime.dat
fix		myat2 all ave/time 1000 1 1000 v_Ntype2in v_Ntype2ou file population2vstime.dat
</code></pre></p><p>
The fixes ave/times allow to evaluate previously defined variables and print the values (here every 1000 steps) into data file. Here each variable simply counts the number of atoms of a specific group in a specific region. Finally, let us terminate the script by adding:
<pre><code># Run

velocity 	all create 1.0 4928459 mom yes rot yes dist gaussian
fix		mynve all nve
fix		mylgv all langevin 1.0 1.0 0.1 1530917 zero yes
fix		myefn all enforce2d
timestep	0.005
thermo		50000
run		1500000
</code></pre></p><p>
There are a few differences with <a href="../tuto01/tuto01a.html">tutorial 1</a>. First, the 'velocity create' command attributes and initial velocity to all the atoms. The initial velocity is chosen so that the initial temperature is equal to 1 (unitless). The additional keywords ensure that no linear momentum and no angular momentum are given to the system, and that the generated velocities are distributed as a Gaussian. Another difference is the 'zero yes' keyword in the langevin thermostat, that ensures that the total random force is equal to zero. 

<br><br>
After running the simulation, you can observe the number of atoms in each region from the generated data files, using for example xmgrace: </p>


<span class="image"><img src="curve.jpg" alt="" /></span>

<p>The system looks like that: </p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/-ouevxQ6-Jw" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<br><br>

<h2>Step 3 -- Going further</h2>
<br>

<p>
You can play with the current script, for example by trying to impose different temperatures. Since the diffusion coefficient of an atom depends strongly on the temperature, you should see variations in the characteristic equilibrium time.

</p>


				</div>
			</div>
			<footer id="footer">
				<div class="inner">
					<section>
						<b>Find me on :</b>
						<br>
						<a href="https://twitter.com/GravelleSimon" target="_blank" class="removelinkdefault"><strong class="fab fa-twitter"></strong> twitter &nbsp; &nbsp;</a>
						
						<a href="https://github.com/simongravelle" target="_blank" class="removelinkdefault"><strong class="fab fa-github"></strong> github &nbsp; &nbsp;</a>
						
						<a href="https://scholar.google.com/citations?user=9fD2JlYAAAAJ&hl=fr" target="_blank" class="removelinkdefault"><strong class="fa fa-graduation-cap"></strong> google scholar &nbsp;&nbsp; </a>
						
						<a href="https://orcid.org/0000-0003-2149-6706" target="_blank" class="removelinkdefault"><strong>iD</strong> orcid &nbsp; &nbsp;</a>
						
						<a href="https://www.youtube.com/channel/UCLmK_9wpyLVpcP7BPgN6BIw?view_as=subscriber" target="_blank" class="removelinkdefault"><strong class="fab fa-youtube"></strong> youtube &nbsp;&nbsp; </a>
						<br> <br>
						<b>See my personal page :</b>
						<br>
						<a href="https://simongravelle.github.io/" target="_blank" target="_blank">simongravelle.github.io</a>	
						<br> <br>
						<b>Contact me by email :</b>
						<br>
						s.gravelle at qmul.ac.uk
					</section>
					<ul class="copyright">
						<li>Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>
		</div>
		<script src="../assets/js/jquery.min.js"></script>
		<script src="../assets/js/browser.min.js"></script>
		<script src="../assets/js/breakpoints.min.js"></script>
		<script src="../assets/js/util.js"></script>
		<script src="../assets/js/main.js"></script>
	</body>
</html>
